import streamlit as st
import time
import os
from gtts import gTTS
from tempfile import NamedTemporaryFile

st.set_page_config(page_title="Sesi√≥n de Reprogramaci√≥n - Murphy & Shinn", layout="centered")
st.markdown("""
<style>
    .title {
        font-size: 2.6em;
        font-weight: bold;
        color: #4B8BBE;
        text-align: center;
        margin-bottom: 10px;
    }
    .subtitle {
        font-size: 1.2em;
        color: #2C3E50;
        text-align: center;
        margin-bottom: 5px;
    }
    .reflection {
        font-size: 1em;
        font-style: italic;
        color: #555;
        text-align: center;
        margin-bottom: 30px;
    }
    .step {
        font-size: 1.2em;
        line-height: 1.6em;
    }
</style>
<div class='title'>üåü Sesi√≥n Transformadora de Reprogramaci√≥n</div>
<div class='subtitle'>Basada en Joseph Murphy y Florence Scovel Shinn</div>
<div class='reflection'>Este es un momento sagrado. Dejo que la Verdad me transforme.</div>
""", unsafe_allow_html=True)

# Estructura de la sesi√≥n
sesion = [
    ("üïäÔ∏è 1. Preparaci√≥n y Aquietamiento", [
        "Cierra tus ojos. Lleva tu atenci√≥n a tu coraz√≥n.",
        "Inhala profundamente‚Ä¶ Exhala tensi√≥n‚Ä¶ (3 ciclos)",
        "Entra en el templo sagrado de tu ser interno.",
        "Aqu√≠ y ahora, el subconsciente se abre a nuevas semillas de verdad."
    ], False),

    ("üí¨ 2. Afirmaciones con Fe y Convicci√≥n", [
        "Estoy alineado con la Sabidur√≠a y el Bien Divino.",
        "La salud, la abundancia, el amor y la paz son mi estado natural.",
        "Lo que me pertenece por derecho divino llega a m√≠ sin esfuerzo y en armon√≠a.",
        "Declaro la Verdad y esta se manifiesta en mi vida."
    ], True),

    ("üåÖ 3. Visualizaci√≥n Creativa y Sentida", [
        "Visualiza con detalle tu vida ideal: en salud, paz, gozo y prop√≥sito.",
        "Siente que ya est√°s ah√≠. Observa, escucha, toca, agradece.",
        "Permite que cada imagen sea una semilla viva que el subconsciente reconoce como real."
    ], True),

    ("üôè 4. Entrega y Gratitud", [
        "Entrego este deseo al orden divino. √âl sabe el c√≥mo.",
        "Conf√≠o en que todo se resuelve de forma perfecta y en el momento perfecto.",
        "Gracias. Esto, o algo mejor, se manifiesta ahora bajo la gracia."
    ], False)
]

contenedor = st.empty()

# Funci√≥n para generar y reproducir audio temporalmente
def reproducir_texto(texto):
    tts = gTTS(text=texto, lang='es')
    with NamedTemporaryFile(delete=False, suffix=".mp3") as tmpfile:
        tts.save(tmpfile.name)
        st.audio(tmpfile.name, format="audio/mp3")
        return tmpfile.name

# Mostrar cada frase con audio opcional
for titulo, frases, usar_audio in sesion:
    for frase in frases:
        with contenedor:
            st.markdown(f"### {titulo}")
            st.markdown(f"<div class='step'>{frase}</div>", unsafe_allow_html=True)
            if usar_audio:
                archivo = reproducir_texto(frase)
        time.sleep(9)

contenedor.success("üåü Has sembrado nuevas creencias. Permanece unos momentos en gratitud y silencio. Todo est√° en marcha.")
